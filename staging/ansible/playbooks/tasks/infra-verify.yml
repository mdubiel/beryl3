---
# Verify Infrastructure Services

- name: Verify infrastructure containers are running
  community.docker.docker_container_info:
    name: "{{ item }}"
  register: container_status
  loop:
    - nginx-proxy
    - docker-registry
    - docker-registry-ui
    - prometheus
    - grafana
    - loki
    - alertmanager
    - node-exporter
    - cadvisor
    - promtail
    - blackbox-exporter
    - nginx-prometheus-exporter
    - adminer

- name: Display infrastructure container status
  debug:
    msg: "{{ item.container.Name }} is {{ item.container.State.Status }}"
  loop: "{{ container_status.results }}"
  when: item.exists

- name: Display infrastructure summary
  debug:
    msg: |
      ========================================
      INFRASTRUCTURE STATUS
      ========================================
      
      ğŸ”„ Reverse Proxy:
      - Nginx Proxy: http://{{ ansible_host }}:80 / https://{{ ansible_host }}:443
      
      ğŸ“Š Monitoring Stack:
      - Prometheus: http://{{ ansible_host }}:9090 | https://prometheus.{{ domain_suffix }}
      - Grafana: http://{{ ansible_host }}:3000 | https://grafana.{{ domain_suffix }}
        â””â”€â”€ Admin: admin / {{ shared_services.grafana.admin_password }}
      - AlertManager: http://{{ ansible_host }}:9093
      
      ğŸ“‹ Log Pipeline:
      - Loki: http://{{ ansible_host }}:3100 | https://loki.{{ domain_suffix }}
      - Promtail: http://{{ ansible_host }}:9080/metrics
      
      ğŸ“ˆ Metrics Exporters:
      - Node Exporter: http://{{ ansible_host }}:9100/metrics
      - cAdvisor: http://{{ ansible_host }}:8080
      - Nginx Exporter: http://{{ ansible_host }}:9113/metrics
      - Blackbox Exporter: http://{{ ansible_host }}:9115
      
      ğŸ—„ï¸ Infrastructure Services:
      - Docker Registry: http://{{ ansible_host }}:5000 | https://registry.{{ domain_suffix }}
      - Registry UI: http://{{ ansible_host }}:8082
      - Adminer (DB): http://{{ ansible_host }}:8084 | https://adminer.{{ domain_suffix }}
      
      ğŸŒ External Access:
      All services available via HTTPS through nginx proxy at https://*.{{ domain_suffix }}
      ========================================