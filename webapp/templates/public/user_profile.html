{% extends "base_public.html" %}
{% load i18n %}
{% load lucide %}
{% load media_tags %}

{% block title %}{{ display_name }} - Public Profile{% endblock %}

{% block breadcrumbs %}
    <li>
        <span class="inline-flex gap-2 items-center">
            {% lucide 'user' size=16 %}
            {{ display_name }}
        </span>
    </li>
{% endblock breadcrumbs %}

{% block content %}
<div class="container mx-auto px-4 py-8">

    {# Task 64: Public User Profile Header #}
    <div class="bg-base-100 rounded-lg shadow-lg mb-8">
        <div class="card-body">
            <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
                {# Avatar placeholder #}
                <div class="avatar placeholder">
                    <div class="bg-primary text-primary-content rounded-full w-24 h-24">
                        <span class="text-3xl font-bold">{{ display_name|first|upper }}</span>
                    </div>
                </div>

                {# User Info #}
                <div class="flex-1 text-center md:text-left">
                    <h1 class="text-4xl font-bold mb-2">{{ display_name }}</h1>

                    <div class="flex flex-col md:flex-row gap-4 text-sm text-base-content/70 mb-4">
                        <div class="flex items-center gap-2 justify-center md:justify-start">
                            {% lucide 'calendar' size=16 %}
                            <span>Joined {{ join_date|date:"F Y" }}</span>
                        </div>
                    </div>

                    {# Statistics Cards #}
                    <div class="stats stats-vertical md:stats-horizontal shadow mt-4">
                        <div class="stat">
                            <div class="stat-figure text-primary">
                                {% lucide 'package' size=32 %}
                            </div>
                            <div class="stat-title">Public Collections</div>
                            <div class="stat-value text-primary">{{ total_collections }}</div>
                        </div>

                        <div class="stat">
                            <div class="stat-figure text-secondary">
                                {% lucide 'box' size=32 %}
                            </div>
                            <div class="stat-title">Total Items</div>
                            <div class="stat-value text-secondary">{{ total_items }}</div>
                        </div>

                        <div class="stat">
                            <div class="stat-figure text-accent">
                                {% lucide 'star' size=32 %}
                            </div>
                            <div class="stat-title">Favorites</div>
                            <div class="stat-value text-accent">{{ total_favorites }}</div>
                        </div>
                    </div>

                    {# Suggest nickname if using ID #}
                    {% if suggest_nickname %}
                    <div class="alert alert-info mt-4">
                        <div class="flex items-start gap-2">
                            {% lucide 'info' size=20 %}
                            <div>
                                <h3 class="font-bold">Set up your custom profile URL</h3>
                                <p class="text-sm">You're currently using your user ID in the URL. Set a nickname in your <a href="{% url 'user_settings' %}" class="link link-primary">account settings</a> to get a personalized URL like <code>/u/yournickname/</code></p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {# Public Collections Section #}
    {% if public_collections %}
    <div class="mb-12">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-2">
            {% lucide 'package' size=28 %}
            Public Collections
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for collection in public_collections %}
            <a href="{% url 'public_collection_view' collection.hash %}" class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300">
                {# Collection Image #}
                {% if collection.default_image.media_file %}
                <figure class="h-48">
                    <img src="{{ collection.default_image.media_file.file_url }}"
                         alt="{{ collection.name }}"
                         class="w-full h-full object-cover">
                </figure>
                {% elif collection.image_url %}
                <figure class="h-48">
                    <img src="{{ collection.image_url }}"
                         alt="{{ collection.name }}"
                         class="w-full h-full object-cover">
                </figure>
                {% else %}
                <figure class="h-48 bg-base-200 flex items-center justify-center">
                    {% lucide 'package' size=64 class='text-base-content/30' %}
                </figure>
                {% endif %}

                <div class="card-body">
                    <h3 class="card-title">{{ collection.name }}</h3>

                    {% if collection.description %}
                    <p class="text-sm text-base-content/70 line-clamp-2">{{ collection.description|truncatewords:20 }}</p>
                    {% endif %}

                    <div class="flex items-center gap-4 text-sm text-base-content/60 mt-2">
                        <div class="flex items-center gap-1">
                            {% lucide 'box' size=14 %}
                            <span>{{ collection.item_count }} item{{ collection.item_count|pluralize }}</span>
                        </div>
                        <div class="flex items-center gap-1">
                            {% lucide 'globe' size=14 %}
                            <span>Public</span>
                        </div>
                    </div>

                    <div class="card-actions justify-end mt-4">
                        <div class="badge badge-ghost">{% lucide 'arrow-right' size=14 %}</div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        <div class="flex items-center gap-2">
            {% lucide 'info' size=20 %}
            <span>{{ display_name }} hasn't made any collections public yet.</span>
        </div>
    </div>
    {% endif %}

    {# Public Favorites Section #}
    {% if public_favorites %}
    <div class="mb-12">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-2">
            {% lucide 'star' size=28 %}
            Favorite Items
        </h2>

        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
            {% for item in public_favorites %}
            <a href="{% url 'public_collection_view' item.collection.hash %}" class="card bg-base-100 shadow hover:shadow-lg transition-shadow duration-300">
                {# Item Image #}
                {% if item.default_image.media_file %}
                <figure class="h-32">
                    <img src="{{ item.default_image.media_file.file_url }}"
                         alt="{{ item.name }}"
                         class="w-full h-full object-cover">
                </figure>
                {% elif item.image_url %}
                <figure class="h-32">
                    <img src="{{ item.image_url }}"
                         alt="{{ item.name }}"
                         class="w-full h-full object-cover">
                </figure>
                {% else %}
                <figure class="h-32 bg-base-200 flex items-center justify-center">
                    {% if item.item_type %}
                        {% lucide item.item_type.icon size=32 class='text-base-content/30' %}
                    {% else %}
                        {% lucide 'box' size=32 class='text-base-content/30' %}
                    {% endif %}
                </figure>
                {% endif %}

                <div class="card-body p-3">
                    <h3 class="text-sm font-bold truncate" title="{{ item.name }}">{{ item.name }}</h3>
                    <div class="flex items-center gap-1 text-xs text-base-content/60">
                        {% lucide 'star' size=12 class='text-warning fill-warning' %}
                        <span class="truncate">{{ item.collection.name }}</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}
