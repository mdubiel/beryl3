{% extends "base_sys.html" %}
{% load lucide %}

{% block title %}System Settings - Beryl Admin{% endblock title %}

{% block page_title %}System Settings{% endblock %}
{% block page_description %}Comprehensive overview of all system configuration values{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Action Buttons -->
    <div class="px-6 pt-6">
        <div class="flex flex-wrap gap-4">
            <a href="{% url 'sys_dashboard' %}" class="btn btn-primary">
                {% lucide 'arrow-left' size=16 class='mr-2' %}
                Dashboard
            </a>
            <a href="{% url 'sys_users' %}" class="btn btn-primary">
                {% lucide 'users' size=16 class='mr-2' %}
                Manage Users
            </a>
        </div>
    </div>

    {# sections container #}
    <div class="mx-6 mb-6 rounded-lg space-y-3">
    
        {# System Settings Header #}
        <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
            {% lucide 'settings' size=18 class='text-primary mr-2' %}
            SYSTEM CONFIGURATION
        </h3>

        <div class="grid grid-cols-1 gap-8">

    <!-- Django Core Settings -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'settings' size=20 %}
                Django Core Settings
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in django_settings.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">
                                {% if value == True %}
                                    <span class="badge badge-success">True</span>
                                {% elif value == False %}
                                    <span class="badge badge-error">False</span>
                                {% elif value is None %}
                                    <span class="text-base-content/50">None</span>
                                {% elif value|length == 0 %}
                                    <span class="text-base-content/50">Empty</span>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Database Settings -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'database' size=20 %}
                Database Configuration
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in database_settings.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">
                                {% if "HIDDEN" in value %}
                                    <span class="badge badge-warning">{{ value }}</span>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Media/Storage Settings -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'cloud' size=20 %}
                Media & Storage Configuration
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in media_settings.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">
                                {% if value == True %}
                                    <span class="badge badge-success">True</span>
                                {% elif value == False %}
                                    <span class="badge badge-error">False</span>
                                {% elif "CONFIGURED" in value %}
                                    <span class="badge badge-info">{{ value }}</span>
                                {% elif "Not configured" in value %}
                                    <span class="text-base-content/50">{{ value }}</span>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Email Settings -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'mail' size=20 %}
                Email Configuration
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in email_settings.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">
                                {% if value == True %}
                                    <span class="badge badge-success">True</span>
                                {% elif value == False %}
                                    <span class="badge badge-error">False</span>
                                {% elif "HIDDEN" in value %}
                                    <span class="badge badge-warning">{{ value }}</span>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Authentication Settings -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'shield' size=20 %}
                Authentication & User Settings
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in auth_settings.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">
                                {% if value == True %}
                                    <span class="badge badge-success">True</span>
                                {% elif value == False %}
                                    <span class="badge badge-error">False</span>
                                {% elif value|length > 50 %}
                                    <div class="text-xs">{{ value|truncatechars:100 }}</div>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Security Settings -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'lock' size=20 %}
                Security Configuration
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in security_settings.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">
                                {% if value == True %}
                                    <span class="badge badge-success">Enabled</span>
                                {% elif value == False %}
                                    <span class="badge badge-error">Disabled</span>
                                {% elif value == 0 %}
                                    <span class="badge badge-neutral">{{ value }}</span>
                                {% elif key == 'CSRF_TRUSTED_ORIGINS' %}
                                    {% if value %}
                                        <div class="space-y-1">
                                            {% for origin in value %}
                                                <div class="badge badge-success badge-sm">{{ origin }}</div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <span class="badge badge-error">Not configured</span>
                                    {% endif %}
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Staging Fixes Status -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'wrench' size=20 %}
                Staging Environment Fixes
                {% if staging_fixes.FIX_STATUS == 'Applied' %}
                    <span class="badge badge-success">{{ staging_fixes.FIX_STATUS }}</span>
                {% else %}
                    <span class="badge badge-error">{{ staging_fixes.FIX_STATUS }}</span>
                {% endif %}
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">CSRF_FIX_APPLIED</td>
                            <td class="font-mono text-sm">
                                {% if staging_fixes.CSRF_FIX_APPLIED %}
                                    <span class="badge badge-success">Yes</span>
                                {% else %}
                                    <span class="badge badge-error">No</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">CSRF_TRUSTED_ORIGINS_COUNT</td>
                            <td class="font-mono text-sm">
                                <span class="badge badge-info">{{ staging_fixes.CSRF_TRUSTED_ORIGINS_COUNT }}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">STAGING_DOMAIN_CONFIGURED</td>
                            <td class="font-mono text-sm">
                                {% if staging_fixes.STAGING_DOMAIN_CONFIGURED %}
                                    <span class="badge badge-success">Yes</span>
                                {% else %}
                                    <span class="badge badge-error">No</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">HTTPS_SUPPORT</td>
                            <td class="font-mono text-sm">
                                {% if staging_fixes.CSRF_HTTPS_CONFIGURED %}
                                    <span class="badge badge-success">Configured</span>
                                {% else %}
                                    <span class="badge badge-warning">Not Configured</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">HTTP_SUPPORT</td>
                            <td class="font-mono text-sm">
                                {% if staging_fixes.CSRF_HTTP_CONFIGURED %}
                                    <span class="badge badge-success">Configured</span>
                                {% else %}
                                    <span class="badge badge-warning">Not Configured</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">LOGGING_FIX_APPLIED</td>
                            <td class="font-mono text-sm">
                                {% if staging_fixes.LOGGING_FIX_APPLIED %}
                                    <span class="badge badge-success">Yes</span>
                                    <span class="text-xs text-base-content/70 ml-2">LogRecord filename conflict resolved</span>
                                {% else %}
                                    <span class="badge badge-error">No</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">CSRF_ORIGINS_LIST</td>
                            <td class="font-mono text-sm">
                                {% if staging_fixes.CSRF_ORIGINS_LIST %}
                                    <div class="space-y-1">
                                        {% for origin in staging_fixes.CSRF_ORIGINS_LIST %}
                                            <div class="badge badge-outline">{{ origin }}</div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <span class="text-base-content/50">No origins configured</span>
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-4 p-4 bg-info/10 rounded-lg">
                <div class="flex items-start gap-2">
                    {% lucide 'info' size=16 class='text-info mt-0.5' %}
                    <div class="text-sm">
                        <p class="font-semibold text-info mb-1">Applied Fixes:</p>
                        <ul class="text-xs text-base-content/70 space-y-1">
                            <li>• CSRF verification error resolved by configuring CSRF_TRUSTED_ORIGINS</li>
                            <li>• Image upload logging error fixed by renaming conflicting LogRecord fields</li>
                            <li>• Environment variable loading improved for containerized deployments</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Settings -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'package' size=20 %}
                Installed Applications ({{ app_settings.TOTAL_APPS }} total)
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <thead>
                        <tr>
                            <th class="w-1/3">Application Name</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app in app_settings.CUSTOM_APPS %}
                        <tr>
                            <td class="font-mono text-sm">{{ app }}</td>
                            <td><span class="badge badge-primary">Custom</span></td>
                        </tr>
                        {% endfor %}
                        {% for app in app_settings.DJANGO_APPS %}
                        <tr>
                            <td class="font-mono text-sm">{{ app }}</td>
                            <td><span class="badge badge-secondary">Django Core</span></td>
                        </tr>
                        {% endfor %}
                        {% for app in app_settings.ALLAUTH_APPS %}
                        <tr>
                            <td class="font-mono text-sm">{{ app }}</td>
                            <td><span class="badge badge-accent">Authentication</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'info' size=20 %}
                System Information
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">Python Version</td>
                            <td class="font-mono text-sm">{{ system_info.Python_Version }}</td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">Django Version</td>
                            <td class="font-mono text-sm">{{ system_info.Django_Version }}</td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">BASE_DIR</td>
                            <td class="font-mono text-sm">{{ system_info.BASE_DIR }}</td>
                        </tr>
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">Project Dir</td>
                            <td class="font-mono text-sm">{{ system_info.Project_Dir }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Environment Variables -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'terminal' size=20 %}
                Environment Variables
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in env_vars.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">
                                {% if "HIDDEN" in value %}
                                    <span class="badge badge-warning">{{ value }}</span>
                                {% elif "Not set" in value %}
                                    <span class="text-base-content/50">{{ value }}</span>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Logging Configuration -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'file-text' size=20 %}
                Logging Configuration
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in logging_settings.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">{{ value }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Static Files Settings -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'folder' size=20 %}
                Static Files Configuration
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <tbody>
                        {% for key, value in static_settings.items %}
                        <tr>
                            <td class="font-mono text-sm font-semibold w-1/3">{{ key }}</td>
                            <td class="font-mono text-sm">
                                {% if value|length == 0 %}
                                    <span class="text-base-content/50">Empty</span>
                                {% else %}
                                    {{ value }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Middleware Configuration -->
    <div class="card bg-base-100 shadow-sm">
        <div class="card-body">
            <h2 class="card-title flex items-center gap-2 mb-4">
                {% lucide 'layers' size=20 %}
                Middleware ({{ middleware_settings.MIDDLEWARE_COUNT }} items)
            </h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <thead>
                        <tr>
                            <th class="w-16">Order</th>
                            <th>Middleware Class</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for middleware in middleware_settings.MIDDLEWARE %}
                        <tr>
                            <td><span class="badge badge-sm badge-outline">{{ forloop.counter }}</span></td>
                            <td class="font-mono text-sm">{{ middleware }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>
    {# / sections container #}
</div>
{% endblock content %}