{% extends "base_sys.html" %}
{% load lucide %}

{% block title %}System Dashboard - Beryl Admin{% endblock %}

{% block page_title %}System Dashboard{% endblock %}
{% block page_description %}Overview of system status and key metrics{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Action Buttons -->
    <div class="px-6 pt-6">
        <div class="flex flex-wrap gap-4">
        <a href="{% url 'sys_users' %}" class="btn btn-primary">
            {% lucide 'users' size=16 class='mr-2' %}
            Manage Users
        </a>
        <a href="{% url 'sys_item_types' %}" class="btn btn-primary">
            {% lucide 'package' size=16 class='mr-2' %}
            Item Types
        </a>
        <a href="{% url 'sys_link_patterns' %}" class="btn btn-primary">
            {% lucide 'link' size=16 class='mr-2' %}
            Link Patterns
        </a>
        <a href="{% url 'sys_metrics' %}" class="btn btn-primary">
            {% lucide 'trending-up' size=16 class='mr-2' %}
            View Metrics
        </a>
        <a href="{% url 'sys_settings' %}" class="btn btn-primary">
            {% lucide 'settings' size=16 class='mr-2' %}
            System Settings
        </a>
        <a href="{% url 'sys_media_browser' %}" class="btn btn-primary">
            {% lucide 'image' size=16 class='mr-2' %}
            Media Browser
        </a>
        </div>
    </div>

    {# Sections container #}
    <div class="mx-6 mb-6 rounded-lg space-y-3">
    
        {# System Status Header #}
        <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
            {% lucide 'activity' size=18 class='text-primary mr-2' %}
            SYSTEM STATUS
        </h3>

        {# System Status Header section #}
        <div class="flex flex-wrap gap-4">
            <div class="flex-1 min-w-48 bg-base-100 p-4 border">
                <div class="flex items-center gap-3 mb-2 ">
                    {% lucide 'users' size=20 class='text-primary' %}
                    <span class="text-sm font-medium text-base-content/70">Total Users</span>
                </div>
                <div class="text-2xl font-bold text-primary">{{ total_users }}</div>
                <div class="text-sm text-base-content/60">{{ active_users }} active (30d)</div>
            </div>
            
            <div class="flex-1 min-w-48 bg-base-100 p-4 border">
                <div class="flex items-center gap-3 mb-2">
                    {% lucide 'package' size=20 class='text-primary' %}
                    <span class="text-sm font-medium text-base-content/70">Collections</span>
                </div>
                <div class="text-2xl font-bold text-primary">{{ total_collections }}</div>
                <div class="text-sm text-base-content/60">User collections</div>
            </div>
            
            <div class="flex-1 min-w-48 bg-base-100 p-4 border">
                <div class="flex items-center gap-3 mb-2">
                    {% lucide 'archive' size=20 class='text-primary' %}
                    <span class="text-sm font-medium text-base-content/70">Items</span>
                </div>
                <div class="text-2xl font-bold text-primary">{{ total_items }}</div>
                <div class="text-sm text-base-content/60">Collection items</div>
            </div>
            
            <div class="flex-1 min-w-48 bg-base-100 p-4 border">
                <div class="flex items-center gap-3 mb-2">
                    {% lucide 'activity' size=20 class='text-primary' %}
                    <span class="text-sm font-medium text-base-content/70">Activity (24h)</span>
                </div>
                <div class="text-2xl font-bold text-primary">{{ recent_user_activity }}</div>
                <div class="text-sm text-base-content/60">Active users</div>
            </div>
        </div>
        {# / System Status Header section #}

        {# Divider #}
        <div class="divider divider-info"></div>

        {# Charts and Analytics #}
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Collection Visibility -->
            <div>
                <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
                    {% lucide 'eye' size=18 class='text-primary mr-2' %}
                    COLLECTION VISIBILITY
                </h3>
                <div class="space-y-2">
                    {% for stat in visibility_stats %}
                    <div class="flex justify-between items-center">
                        <span class="terminal-text">{{ stat.visibility|title }}</span>
                        <div class="flex items-center gap-2">
                            <div class="w-24 bg-primary bg-opacity-20 h-2">
                                <div class="bg-primary h-2" style="width: {% widthratio stat.count total_collections 100 %}%"></div>
                            </div>
                            <span class="terminal-accent text-sm">{{ stat.count }}</span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="terminal-text opacity-60">// No visibility data available</div>
                    {% endfor %}
                </div>
            </div>

        <!-- Item Status Distribution -->
            <div>
                <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
                    {% lucide 'trending-up' size=18 class='text-primary mr-2' %}
                    ITEM STATUS
                </h4>
                <div class="space-y-2">
                    {% for stat in status_stats %}
                    <div class="flex justify-between items-center">
                        <span class="terminal-text">{{ stat.status|title|slice:":15" }}</span>
                        <div class="flex items-center gap-2">
                            <div class="w-24 bg-primary bg-opacity-20 h-2">
                                <div class="bg-primary h-2" style="width: {% widthratio stat.count total_items 100 %}%"></div>
                            </div>
                            <span class="terminal-accent text-sm">{{ stat.count }}</span>
                        </div>
                    </div>
                    {% empty %}
                    <div class="terminal-text opacity-60">// No status data available</div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {# / Charts and Analytics #}

    <div class="divider divider-info"></div>

    <!-- System Information -->
        <h3 class="terminal-accent text-lg font-bold mb-2 flex items-center">
            {% lucide 'server' size=18 class='text-primary mr-2' %}
            SYSTEM INFO
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm p-0">
            <div>
                <div class="terminal-text mb-2">Django Version: <span class="terminal-accent">{{ django_version|default:"Unknown" }}</span></div>
                <div class="terminal-text mb-2">Site Domain: <span class="terminal-accent">{{ SITE_DOMAIN }}</span></div>
                <div class="terminal-text mb-2">Database: <span class="terminal-accent">{{ database_engine|default:"SQLite" }}</span></div>
                <div class="terminal-text mb-2">Debug Mode: <span class="{% if debug %}terminal-danger{% else %}terminal-accent{% endif %}">{{ debug|yesno:"ENABLED,DISABLED" }}</span></div>
            </div>
            <div>
                <div class="terminal-text mb-2">Server Time: <span class="terminal-accent" id="server-time">{{ now|date:"Y-m-d H:i:s T" }}</span></div>
                <div class="terminal-text mb-2">External Services: 
                    <span class="terminal-accent">
                        {% if EXTERNAL_DB_URL %}DB {% endif %}
                        {% if EXTERNAL_INBUCKET_URL %}EMAIL {% endif %}
                        {% if EXTERNAL_MONITORING_URL %}MONITOR {% endif %}
                        {% if EXTERNAL_LOKI_URL %}LOKI {% endif %}
                        {% if EXTERNAL_GRAFANA_URL %}GRAFANA {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
    {# / sections container #}
    </div> <!-- End Dashboard Sections -->
</div>

<script>
// Auto-refresh system time
setInterval(() => {
    const timeElement = document.getElementById('server-time');
    if (timeElement) {
        const now = new Date();
        timeElement.textContent = now.toLocaleString();
    }
}, 1000);
</script>
{% endblock %}