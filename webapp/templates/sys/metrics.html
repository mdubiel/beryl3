{% extends "base_sys.html" %}
{% load lucide %}

{% block title %}System Metrics - Beryl Admin{% endblock %}

{% block page_title %}System Metrics{% endblock %}
{% block page_description %}Daily metrics dashboard with trend analysis{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Action Buttons -->
    <div class="px-6 pt-6">
        <div class="flex flex-wrap gap-4 items-center justify-between">
            <div class="flex flex-wrap gap-4">
                <a href="{% url 'sys_prometheus_metrics' %}" class="btn btn-primary btn-sm" target="_blank">
                    {% lucide 'activity' size=16 class='mr-2' %}
                    Prometheus Metrics
                </a>
                <a href="{% url 'sys_dashboard' %}" class="btn btn-primary btn-sm">
                    {% lucide 'arrow-left' size=16 class='mr-2' %}
                    Dashboard
                </a>
            </div>

            {% if latest_metrics %}
            <div class="text-sm text-gray-600">
                Last collection: {{ latest_metrics.collected_at|date:"Y-m-d H:i:s" }} ({{ latest_metrics.collection_duration_seconds }}s)
            </div>
            {% endif %}
        </div>
    </div>

    {% if no_metrics %}
    <!-- No Metrics Available -->
    <div class="mx-6 mb-6 terminal-bg p-6">
        <div class="text-center py-8">
            <div class="text-yellow-500 mb-4">
                {% lucide 'triangle-alert' size=48 class='mx-auto' %}
            </div>
            <h3 class="text-lg font-bold terminal-accent mb-2">No Metrics Available</h3>
            <p class="terminal-text mb-4">Daily metrics have not been collected yet.</p>
            <p class="text-sm terminal-text opacity-60">
                Run: <code class="terminal-accent">python manage.py collect_daily_metrics</code>
            </p>
        </div>
    </div>
    {% else %}

    <!-- Alert Threshold Legend -->
    <div class="mx-6 mb-4">
        <div class="text-sm terminal-text opacity-70">
            Trend indicators:
            <span class="text-success">â†‘ Increase</span> |
            <span class="text-error">â†“ Decrease</span> |
            <span class="text-warning">âš  {{ alert_warning }}% warning</span> |
            <span class="text-error font-bold">ðŸ”´ {{ alert_critical }}% critical</span>
        </div>
    </div>

    <!-- User Metrics -->
    <div class="mx-6 mb-6 terminal-bg">
        <div class="p-6">
            <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
                {% lucide 'users' size=18 class='text-primary mr-2' %}
                USER METRICS
            </h3>
            <div class="overflow-x-auto">
                <table class="table table-sm w-full">
                    <thead>
                        <tr class="border-b border-primary">
                            <th class="terminal-text">Metric</th>
                            <th class="text-right terminal-text">Current</th>
                            <th class="text-right terminal-text">vs Yesterday</th>
                            <th class="text-right terminal-text">vs 7 Days</th>
                            <th class="text-right terminal-text">vs 30 Days</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="terminal-text">Total Users</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.total_users.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_users.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_users.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_users.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Active Users (24h)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.active_users_24h.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_24h.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_24h.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_24h.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Active Users (7d)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.active_users_7d.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_7d.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_7d.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_7d.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Active Users (30d)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.active_users_30d.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_30d.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_30d.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.active_users_30d.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">New Users (24h)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.new_users_24h.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_24h.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_24h.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_24h.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">New Users (7d)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.new_users_7d.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_7d.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_7d.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_7d.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">New Users (30d)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.new_users_30d.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_30d.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_30d.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.new_users_30d.change_30d %}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Collection Metrics -->
    <div class="mx-6 mb-6 terminal-bg">
        <div class="p-6">
            <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
                {% lucide 'archive' size=18 class='text-primary mr-2' %}
                COLLECTION METRICS
            </h3>
            <div class="overflow-x-auto">
                <table class="table table-sm w-full">
                    <thead>
                        <tr class="border-b border-primary">
                            <th class="terminal-text">Metric</th>
                            <th class="text-right terminal-text">Current</th>
                            <th class="text-right terminal-text">vs Yesterday</th>
                            <th class="text-right terminal-text">vs 7 Days</th>
                            <th class="text-right terminal-text">vs 30 Days</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="terminal-text">Total Collections</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.total_collections.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_collections.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_collections.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_collections.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Private Collections</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.collections_private.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_private.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_private.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_private.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Public Collections</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.collections_public.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_public.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_public.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_public.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Unlisted Collections</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.collections_unlisted.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_unlisted.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_unlisted.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_unlisted.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Created (24h)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.collections_created_24h.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_24h.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_24h.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_24h.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Created (7d)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.collections_created_7d.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_7d.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_7d.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_7d.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Created (30d)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.collections_created_30d.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_30d.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_30d.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.collections_created_30d.change_30d %}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Item Metrics -->
    <div class="mx-6 mb-6 terminal-bg">
        <div class="p-6">
            <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
                {% lucide 'package' size=18 class='text-primary mr-2' %}
                ITEM METRICS
            </h3>
            <div class="overflow-x-auto">
                <table class="table table-sm w-full">
                    <thead>
                        <tr class="border-b border-primary">
                            <th class="terminal-text">Metric</th>
                            <th class="text-right terminal-text">Current</th>
                            <th class="text-right terminal-text">vs Yesterday</th>
                            <th class="text-right terminal-text">vs 7 Days</th>
                            <th class="text-right terminal-text">vs 30 Days</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="terminal-text">Total Items</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.total_items.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_items.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_items.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_items.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">In Collection</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_in_collection.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_in_collection.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_in_collection.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_in_collection.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Wanted</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_wanted.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_wanted.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_wanted.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_wanted.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Reserved</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_reserved.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_reserved.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_reserved.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_reserved.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Favorites</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.favorite_items_total.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.favorite_items_total.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.favorite_items_total.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.favorite_items_total.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Created (24h)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_created_24h.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_24h.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_24h.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_24h.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Created (7d)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_created_7d.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_7d.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_7d.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_7d.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Created (30d)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_created_30d.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_30d.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_30d.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_created_30d.change_30d %}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Storage Metrics -->
    <div class="mx-6 mb-6 terminal-bg">
        <div class="p-6">
            <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
                {% lucide 'hard-drive' size=18 class='text-primary mr-2' %}
                STORAGE METRICS
            </h3>
            <div class="overflow-x-auto">
                <table class="table table-sm w-full">
                    <thead>
                        <tr class="border-b border-primary">
                            <th class="terminal-text">Metric</th>
                            <th class="text-right terminal-text">Current</th>
                            <th class="text-right terminal-text">vs Yesterday</th>
                            <th class="text-right terminal-text">vs 7 Days</th>
                            <th class="text-right terminal-text">vs 30 Days</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="terminal-text">Total Media Files</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.total_media_files.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_media_files.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_media_files.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_media_files.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Total Storage</td>
                            <td class="text-right font-bold terminal-accent">{{ latest_metrics.total_storage_bytes|filesizeformat }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_storage_bytes.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_storage_bytes.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.total_storage_bytes.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Uploads (24h)</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.recent_uploads_24h.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.recent_uploads_24h.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.recent_uploads_24h.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.recent_uploads_24h.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Orphaned Files</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.orphaned_files.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.orphaned_files.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.orphaned_files.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.orphaned_files.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Corrupted Files</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.corrupted_files.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.corrupted_files.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.corrupted_files.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.corrupted_files.change_30d %}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Engagement Metrics -->
    <div class="mx-6 mb-6 terminal-bg">
        <div class="p-6">
            <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
                {% lucide 'trending-up' size=18 class='text-primary mr-2' %}
                ENGAGEMENT METRICS
            </h3>
            <div class="overflow-x-auto">
                <table class="table table-sm w-full">
                    <thead>
                        <tr class="border-b border-primary">
                            <th class="terminal-text">Metric</th>
                            <th class="text-right terminal-text">Current</th>
                            <th class="text-right terminal-text">vs Yesterday</th>
                            <th class="text-right terminal-text">vs 7 Days</th>
                            <th class="text-right terminal-text">vs 30 Days</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="terminal-text">Items with Images</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_with_images_pct.current }}%</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_images_pct.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_images_pct.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_images_pct.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Items with Attributes</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_with_attributes_pct.current }}%</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_attributes_pct.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_attributes_pct.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_attributes_pct.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Items with Links</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.items_with_links_pct.current }}%</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_links_pct.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_links_pct.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.items_with_links_pct.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Avg Attributes per Item</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.avg_attributes_per_item.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.avg_attributes_per_item.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.avg_attributes_per_item.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.avg_attributes_per_item.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Avg Items per Collection</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.avg_items_per_collection.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.avg_items_per_collection.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.avg_items_per_collection.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.avg_items_per_collection.change_30d %}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Content Moderation Metrics -->
    <div class="mx-6 mb-6 terminal-bg">
        <div class="p-6">
            <h3 class="terminal-accent text-lg font-bold mb-4 flex items-center">
                {% lucide 'shield' size=18 class='text-primary mr-2' %}
                CONTENT MODERATION
            </h3>
            <div class="overflow-x-auto">
                <table class="table table-sm w-full">
                    <thead>
                        <tr class="border-b border-primary">
                            <th class="terminal-text">Metric</th>
                            <th class="text-right terminal-text">Current</th>
                            <th class="text-right terminal-text">vs Yesterday</th>
                            <th class="text-right terminal-text">vs 7 Days</th>
                            <th class="text-right terminal-text">vs 30 Days</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="terminal-text">Flagged Content</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.flagged_content.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.flagged_content.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.flagged_content.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.flagged_content.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Pending Review</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.pending_review.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.pending_review.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.pending_review.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.pending_review.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">User Violations</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.user_violations.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.user_violations.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.user_violations.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.user_violations.change_30d %}</td>
                        </tr>
                        <tr>
                            <td class="terminal-text">Banned Users</td>
                            <td class="text-right font-bold terminal-accent">{{ metrics_data.banned_users.current }}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.banned_users.change_1d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.banned_users.change_7d %}</td>
                            <td class="text-right">{% include 'partials/_trend_indicator.html' with change=metrics_data.banned_users.change_30d %}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {% endif %}
</div>

<script>
// Auto-refresh metrics every 5 minutes
setInterval(() => {
    window.location.reload();
}, 300000);
</script>
{% endblock %}
