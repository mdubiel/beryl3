{% load lucide %}

{% if locations %}
    {% for location in locations %}
    <button type="button"
            class="w-full px-3 py-2 hover:bg-base-200 cursor-pointer flex items-center gap-2 text-left text-sm"
            onmousedown="window.comboboxSelect('location', '{{ location.id }}', '{{ location.name|escapejs }}'); return false;">
        {% lucide 'map-pin' size=12 %}
        <span data-combobox-item-name="{{ location.name }}"></span>
        {% if location.description %}
            <span class="text-xs text-neutral ml-2">{{ location.description|truncatewords:5 }}</span>
        {% endif %}
    </button>
    {% endfor %}
    <script>
        // Show dropdown and highlight query
        var containerId = document.getElementById('combobox-location-results') ? 'combobox-location-results' : 'combobox-form-location-results';
        var container = document.getElementById(containerId);
        if (container) {
            container.classList.remove('hidden');
            window.comboboxHighlightQuery(containerId, '{{ query }}');
        }
    </script>
{% else %}
    <script>
        // Hide dropdown when no results
        ['combobox-location-results', 'combobox-form-location-results'].forEach(function(id) {
            var el = document.getElementById(id);
            if (el) el.classList.add('hidden');
        });
    </script>
{% endif %}
