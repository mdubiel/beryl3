{% load lucide %}

<div class="mt-4" id="item-links-{{ item.hash }}">
    {% if item.links.all %}
        <div class="flex flex-wrap gap-1 max-w-2xl">
            {% for link in item.links.all %}
            <div class="inline-flex items-center gap-1 mr-2 mb-1">
                {# Combined link text and icon #}
                <a href="{{ link.url }}" target="_blank" class="text-xs flex items-center gap-1 hover:text-primary" title="{{ link.get_display_name }}: {{ link.url }}">
                    {{ link.get_display_name }}
                    {% lucide link.get_icon size=10 %}
                </a>

                {# Separate actions dropdown (only for owners) #}
                {% if request.user == item.collection.created_by %}
                <div class="dropdown dropdown-end flex-shrink-0 ml-1">
                    <button tabindex="0" class="p-1 hover:bg-base-200 rounded cursor-pointer" title="Link Actions">
                        {% lucide 'ellipsis' size=10 %}
                    </button>
                    <ul tabindex="0" class="dropdown-content menu p-1 shadow bg-base-100 rounded-box w-32 z-10">
                        <li>
                            <a class="text-xs py-1 px-2"
                               hx-get="{% url 'item_edit_link' item.hash link.id %}"
                               hx-target="#link-edit-modal-content"
                               hx-trigger="click"
                               onclick="document.getElementById('link-edit-modal').showModal()">
                                {% lucide 'pencil' size=12 %}
                                Edit
                            </a>
                        </li>
                        <li>
                            <a class="text-xs py-1 px-2 text-error"
                               hx-delete="{% url 'item_remove_link' item.hash link.id %}"
                               hx-target="#item-links-{{ item.hash }}"
                               hx-swap="outerHTML"
                               hx-confirm="Remove {{ link.get_display_name }}?"
                               hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                                {% lucide 'trash-2' size=12 %}
                                Delete
                            </a>
                        </li>
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% endif %}
</div>