{% load i18n %}
{% load lucide %}

{# Main response: Updated visibility dropdown #}
<div id="visibility-dropdown-{{ collection.hash }}" class="dropdown dropdown-end dropdown-bottom">
    <button tabindex="0" class="btn btn-ghost btn-square btn-sm" title="Change Visibility">
        {% lucide 'settings' size=18 %}
    </button>
    <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52 z-10">
        <li class="menu-title"><span>Change Visibility</span></li>
        {% for visibility_value, visibility_label in collection.Visibility.choices %}
        <li>
            {% if collection.visibility == visibility_value %}
                <a class="disabled font-bold">{{ visibility_label }}</a>
            {% else %}
                <a  hx-post="{% url 'collection_update_visibility' collection.hash %}"
                    hx-vals='{"new_visibility": "{{ visibility_value }}"}'
                    hx-target="#visibility-dropdown-{{ collection.hash }}"
                    hx-swap="outerHTML"
                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                    {{ visibility_label }}
                </a>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>

{# Out-of-band swap: Update share section #}
<div id="share-section-{{ collection.hash }}" class="share-section" hx-swap-oob="true">
{% if collection.visibility != 'PRIVATE' %}
<div class="mt-3 flex flex-col sm:flex-row items-center lg:items-start gap-2">
    <div class="join">
        <input type="text" value="{{ collection.get_sharable_url }}" readonly class="input input-xs input-bordered join-item text-xs w-96" />
        <button class="btn btn-xs join-item" onclick="copyToClipboard(this.previousElementSibling, this)">
            {% lucide 'copy' size=12 %}
        </button>
        <a href="{{ collection.get_sharable_url }}" target="_blank" class="btn btn-xs join-item" title="Open public view">
            {% lucide 'external-link' size=12 %}
        </a>
        <div class="btn btn-xs join-item gap-1 {% if collection.visibility == 'PUBLIC' %}btn-accent{% else %}btn-info{% endif %} cursor-default">
            {% lucide 'globe' size=10 %}
            {{ collection.get_visibility_display }}
        </div>
    </div>
</div>
{% endif %}
</div>