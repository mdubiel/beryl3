{% load lucide %}

<form hx-post="{% url 'item_save_personal_info' item.hash %}"
      hx-target="#item-personal-info-{{ item.hash }}"
      hx-swap="outerHTML"
      hx-on::after-request="if (event.detail.pathInfo.requestPath.includes('save-personal-info')) { document.getElementById('personal-info-edit-modal').close(); }"
      hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
      class="space-y-4">

    <input type="hidden" name="field_name" value="location">
    <input type="hidden" name="location" id="combobox-location-value" value="{{ item.location.id|default:'' }}">
    <input type="hidden" name="location_name" id="combobox-location-name" value="">

    <div class="form-control relative">
        <label class="label">
            <span class="label-text">Location</span>
        </label>
        <div class="relative">
            <input type="text"
                   id="combobox-location-search"
                   name="q"
                   class="input input-bordered w-full"
                   placeholder="Type location name..."
                   value="{{ item.location.name|default:'' }}"
                   autocomplete="off"
                   data-combobox="location"
                   data-combobox-submit="true"
                   hx-get="{% url 'location_autocomplete' %}"
                   hx-trigger="keyup changed delay:300ms, input changed delay:300ms"
                   hx-target="#combobox-location-results"
                   hx-swap="innerHTML"
                   hx-include="this">
            <div id="combobox-location-results"
                 class="absolute w-full bg-base-100 shadow-lg rounded-box mt-1 max-h-60 overflow-y-auto border border-base-300 hidden z-[9999]">
                <!-- Autocomplete results will appear here -->
            </div>
        </div>
        <div class="text-xs text-base-content/70 mt-1">
            Type to search existing locations, or enter a new name to create one.
        </div>
    </div>

    <div class="flex justify-end gap-2">
        <button type="button"
                class="btn btn-ghost text-error hover:bg-error hover:text-error-content"
                onclick="window.comboboxClear('location'); this.closest('form').requestSubmit()">
            {% lucide 'trash-2' size=16 class='mr-2' %}
            Clear
        </button>
        <button type="button"
                class="btn btn-ghost"
                onclick="document.getElementById('personal-info-edit-modal').close()">
            Cancel
        </button>
        <button type="submit"
                class="btn btn-primary">
            {% lucide 'save' size=16 class='mr-2' %}
            Save
        </button>
    </div>
</form>
