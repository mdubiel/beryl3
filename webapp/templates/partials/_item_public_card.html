{% load lucide %}
{% load media_tags %}

<div class="card lg:card-side bg-base-100 min-w-80 max-w-md lg:min-w-96 lg:max-w-none mx-auto lg:mx-0 shadow-md hover:shadow-lg transition-shadow">
    {# Image section using DaisyUI figure #}
    <figure class="lg:w-1/4 w-full h-48 lg:h-auto lg:self-stretch">
        {% if item.default_image %}
            <img src="{% media_url item.default_image.media_file %}" alt="{{ item.name }}" class="w-full h-full object-cover" />
        {% elif item.images.all.0 %}
            <img src="{% media_url item.images.all.0.media_file %}" alt="{{ item.name }}" class="w-full h-full object-cover" />
        {% else %}
            <div class="w-full h-full bg-base-300 flex items-center justify-center">
                {% lucide 'image' size=64 class='text-neutral' %}
            </div>
        {% endif %}
    </figure>
    {# Content section using DaisyUI card-body #}
    <div class="card-body lg:w-3/4 flex flex-col justify-between">
        
        {# Top section #}
        <div class="space-y-3">
            
            {# Row 1: Item name with favorite star #}
            <div class="flex flex-wrap lg:flex-nowrap items-center justify-between gap-4">
                <div class="flex items-center gap-2 flex-grow">
                    {# Favorite star - display only (not interactive for public view) #}
                    {% if item.is_favorite %}
                    <div class="tooltip" data-tip="Owner's favorite">
                        {% lucide 'star' size=20 class='text-warning fill-current' %}
                    </div>
                    {% endif %}
                    
                    <h2 class="font-bold text-lg leading-tight">
                        {{ item.name }}
                    </h2>
                </div>
                
                {# Item type badge #}
                {% if item.item_type %}
                <div class="badge badge-secondary">
                    {% lucide item.item_type.icon size=14 class='mr-1' %}
                    {{ item.item_type.display_name }}
                </div>
                {% endif %}
            </div>
            
            {# Row 2: Description #}
            {% if item.description %}
            <div>
                <p class="text-sm opacity-70">{{ item.description }}</p>
            </div>
            {% endif %}
            
            {# Row 3: Status badge #}
            <div class="flex flex-wrap gap-2">
                <div class="badge {% if item.status == 'IN_COLLECTION' %}badge-success{% elif item.status == 'WANTED' %}badge-info{% elif item.status == 'RESERVED' %}badge-warning{% else %}badge-neutral{% endif %}">
                    {% lucide 'tag' size=12 class='mr-1' %}
                    {{ item.get_status_display }}
                </div>
            </div>
            
            {# Row 4: Attributes display (detailed like private view) #}
            {% if item.item_type %}
                {% with attributes=item.get_display_attributes %}
                    {% if attributes|length > 0 %}
                        <div class="mt-3">
                            <div class="space-y-1">
                                {% for attr_data in attributes %}
                                <div class="flex items-center justify-between py-1 {% if not forloop.last %}border-b border-base-300{% endif %}">
                                    <span class="text-xs" title="{{ attr_data.attribute.display_name }}: {{ attr_data.value }}">
                                        <strong>{{ attr_data.attribute.display_name }}:</strong> 
                                        {% if attr_data.attribute.attribute_type == 'URL' %}
                                            <a href="{{ attr_data.value }}" target="_blank" class="link link-hover text-primary">
                                                {{ attr_data.value }}
                                            </a>
                                        {% elif attr_data.attribute.attribute_type == 'BOOLEAN' %}
                                            {% if attr_data.value %}Yes{% else %}No{% endif %}
                                        {% elif attr_data.attribute.attribute_type == 'DATE' %}
                                            {{ attr_data.display_value }}
                                        {% else %}
                                            {{ attr_data.value }}
                                        {% endif %}
                                    </span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
            {% endif %}
            
            {# Row 5: Links display (detailed like private view) #}
            {% if item.links.all %}
                <div class="mt-3">
                    <div class="flex flex-wrap gap-1 max-w-2xl">
                        {% for link in item.links.all %}
                        <div class="inline-flex items-center gap-1 mr-2 mb-1">
                            <a href="{{ link.url }}" target="_blank" class="text-xs flex items-center gap-1 hover:text-primary" title="{{ link.get_display_name }}: {{ link.url }}">
                                {{ link.get_display_name }}
                                {% lucide link.get_icon size=10 %}
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            
            {# Row 6: All images - thumbnails using avatar styling #}
            {% if item.images.all|length > 0 %}
            <div class="mt-3">
                <div class="flex flex-wrap gap-1 justify-start">
                    {% for image in item.images.all %}
                    <div class="avatar cursor-pointer hover:opacity-75 transition-opacity" onclick="showImageModal('{% media_url image.media_file %}', '{{ item.name|escapejs }} - Image {{ forloop.counter }}')">
                        <div class="w-12 h-12 rounded">
                            <img src="{% media_url image.media_file %}" alt="{{ item.name }} - Image {{ forloop.counter }}" class="object-cover" />
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
        </div>
        
        {# Bottom section - Action buttons #}
        <div class="flex justify-end mt-4">
            {% if item.is_bookable %}
                {% if request.user.is_authenticated %}
                    {# Authenticated user: Simple POST to book #}
                    <button class="btn btn-sm btn-primary"
                            hx-post="{% url 'book_item_authenticated' item.hash %}"
                            hx-target="#item-{{ item.hash }}-container"
                            hx-swap="innerHTML"
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                        {% lucide 'bookmark' size=14 class='mr-1' %}
                        Reserve
                    </button>
                {% else %}
                    {# Unauthenticated user: Dropdown with an inline form #}
                    <div class="dropdown dropdown-end">
                        <button tabindex="0" class="btn btn-sm btn-primary">
                            {% lucide 'bookmark' size=14 class='mr-1' %}
                            Reserve
                        </button>
                        <div tabindex="0" class="dropdown-content z-10 card card-compact w-64 p-2 shadow bg-base-200 text-base-content">
                            <form hx-post="{% url 'book_item_guest' item.hash %}"
                                  hx-target="#item-{{ item.hash }}-container"
                                  hx-swap="innerHTML"
                                  hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'  
                                  class="card-body p-2">
                                <p class="text-sm font-semibold mb-1">Reserve as guest:</p>
                                <div class="form-control">
                                    <input type="email" name="email" placeholder="your.email@example.com" class="input input-bordered input-sm" required>
                                </div>
                                <p class="text-xs text-neutral mt-1">We'll send you a confirmation email with a cancellation link.</p>
                                <button type="submit" class="btn btn-success btn-sm mt-2">
                                    {% lucide 'check' size=14 class='mr-1' %}
                                    Confirm
                                </button>
                            </form>
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        </div>
        
    </div>
</div>